<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login (Mobile/Password)</title>

<style>
  :root{
    --bg:#0b0d10; --card:#0f1114; --muted:#9aa0a6;
    --primary:#38a169; --primary-text:#031013;
    --secondary:#1f2933; --secondary-text:#e6eef3;
  }

  html,body{
    margin:0;
    background:var(--bg);
    color:#e6eef3;
    font-family:Inter,system-ui;
  }

  .container{
    max-width:640px;
    margin:32px auto;
    padding:16px;
  }

  .card{
    background:var(--card);
    border-radius:10px;
    padding:22px;
    box-shadow:0 4px 18px rgba(0,0,0,.5);
  }

  h1{margin:0;font-size:18px;}

  .card-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:16px;
  }

  form{
    display:flex;
    flex-direction:column;
    gap:14px;
  }

  input{
    width:100%;
    padding:14px;
    font-size:15px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,.05);
    background:#0b0d10;
    color:#e6eef3;
    box-sizing:border-box;
  }

  .row{
    display:flex;
    justify-content:space-between;
    gap:14px;
    margin-top:4px;
  }

  .btn{
    padding:12px;
    flex:1;
    text-align:center;
    font-size:14px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    box-sizing:border-box;
  }

  .btn-primary{background:var(--primary);color:var(--primary-text);}
  .btn-secondary{background:var(--secondary);color:var(--secondary-text);}
  .btn:disabled{opacity:.6;}

  .resp-box{
    background:#1a1c1f;
    border-radius:8px;
    margin-top:20px;
    display:none;
  }

  table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
  }

  td{
    padding:12px;
    border-bottom:1px solid #333;
  }

  .key{color:#9aa0a6;width:110px;}
  .val{word-break:break-all;max-width:300px;}

  .copy-btn{
    background:#2d2f33;
    color:#ccc;
    border:none;
    padding:6px 10px;
    border-radius:6px;
    cursor:pointer;
    font-size:12px;
  }
</style>
</head>

<body>
<div class="container">
  <div class="card">

    <div class="card-header">
      <h1>Login (Mobile/Password)</h1>
    </div>

    <form id="loginForm">
      <input id="type" type="number" placeholder="type (ex: 1)" required />
      <input id="mobile" type="text" placeholder="mobile (ex: 1234567890)" required />
      <input id="password" type="text" placeholder="password (ex: 123)" required />

      <div class="row">
        <button id="clearBtn" type="button" class="btn btn-secondary">Clear</button>
        <button id="submitBtn" type="submit" class="btn btn-primary">Submit</button>
      </div>
    </form>

    <div class="resp-box" id="respBox">
      <table id="respTable"></table>
    </div>

  </div>
</div>

<script>
(function(){

  const form = document.getElementById("loginForm");
  const submitBtn = document.getElementById("submitBtn");
  const clearBtn = document.getElementById("clearBtn");
  const respBox = document.getElementById("respBox");
  const respTable = document.getElementById("respTable");

  clearBtn.addEventListener("click", ()=>{
    form.reset();
    respBox.style.display = "none";
    respTable.innerHTML = "";
  });

  function renderResponse(json){
    respTable.innerHTML = "";

    Object.entries(json).forEach(([k,v])=>{
      let vStr;
      if(typeof v === 'object' && v !== null){
        vStr = JSON.stringify(v, null, 2);
      } else {
        // Use String(v) to avoid extra quotes on simple types (numbers, strings)
        vStr = String(v); 
      }
      const enc  = encodeURIComponent(vStr);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="key">${k}</td>
        <td class="val">${vStr}</td>
        <td><button class="copy-btn" data-val="${enc}">Copy</button></td>
      `;
      respTable.appendChild(tr);
    });

    respBox.style.display = "block";
  }

  // Copy delegate
  respTable.addEventListener("click",(e)=>{
    if(e.target.classList.contains("copy-btn")){
      const raw = decodeURIComponent(e.target.dataset.val);
      navigator.clipboard.writeText(raw);
    }
  });

  form.addEventListener("submit", async (e)=>{
    e.preventDefault();
    submitBtn.disabled = true;

    // Logic Update: Create JSON payload
    const payload = {
      type: parseInt(form.type.value.trim(), 10),
      mobile: form.mobile.value.trim(),
      // Since your curl command passes password as an integer literal (123), 
      // we'll parse it as an integer before sending. If the password should be a string, 
      // remove the parseInt().
      password: parseInt(form.password.value.trim(), 10) 
    };
    
    try{
      const baseurl = window.location.origin;

      // Logic Update: Set Content-Type header
      const headers = {
        "Content-Type": "application/json"
      };
      
      // No Authorization header

      // Logic Update: Use POST method, JSON body, and correct endpoint /auth/login-password-mobile
      const resp = await fetch(baseurl + "/auth/login-password-mobile", {
        method:"POST",
        headers: headers,
        body: JSON.stringify(payload)
      });

      const raw = await resp.text();

      let json;
      try { 
        json = JSON.parse(raw);
        renderResponse({
          status: json.status !== undefined ? json.status : resp.status,
          message: json.message !== undefined ? json.message : json
        });
      }
      catch { 
        renderResponse({
          status: resp.status,
          message: raw || "Invalid response"
        });
      }

    }catch(err){
      renderResponse({
        status: 0,
        message: err.message || "error"
      });

    }finally{
      submitBtn.disabled = false;
    }
  });

})();
</script>

</body>
</html>
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jira JQL Output Save</title>
<style>
  :root{
    --bg:#0b0d10; --card:#0f1114; --muted:#9aa0a6;
    --primary:#38a169; --primary-text:#031013;
    --secondary:#1f2933; --secondary-text:#e6eef3;
  }

  html,body{
    height:100%;
    margin:0;
    background:linear-gradient(180deg,var(--bg),#070708);
    color:#e6eef3;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  }

  .container{
    max-width:640px;
    margin:32px auto;
    padding:20px;
  }

  .card{
    background:var(--card);
    border-radius:10px;
    padding:28px 28px 16px;
    box-shadow:0 6px 24px rgba(0,0,0,.6);
    margin-bottom:20px;
  }

  h1{margin:0;font-size:18px;font-weight:600;color:#fff}

  form{
    display:flex;
    flex-direction:column;
    gap:14px;
  }

  input{
    width:100%;
    padding:18px 14px;
    font-size:16px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,.04);
    background:#0b0d10;
    color:#e6eef3;
    outline:none;
    box-sizing:border-box;
  }

  .row{
    display:flex;
    gap:20px;
    margin-bottom:14px;
    margin-top:14px;
  }

  .row > *{flex:1}

  .btn{
    margin:0;
    padding:14px;
    font-size:15px;
    border-radius:10px;
    border:none;
    cursor:pointer;
  }

  .btn-primary{background:var(--primary);color:var(--primary-text);}
  .btn-secondary{background:var(--secondary);color:var(--secondary-text);}
  .btn:disabled{opacity:.6;cursor:not-allowed;}

  .small{
    font-size:13px;
    color:var(--muted);
    text-align:left;
    margin-top:6px;
    white-space:pre-wrap;
  }

  pre{
    background:#1a1c1f;
    padding:12px;
    border-radius:8px;
    overflow:auto;
    font-size:13px;
    line-height:1.5;
    white-space:pre;
  }

  .card-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
  }
</style>
</head>
<body>
<div class="container">

  <div class="card">
    <div class="card-header">
      <h1>Jira JQL Output Save</h1>
      <input id="token" placeholder="token"
        style="padding:6px 8px;font-size:12px;border-radius:6px;
        border:1px solid rgba(255,255,255,.08);background:#0b0d10;
        color:#e6eef3;width:220px;">
    </div>

    <pre id="curlBlock">curl -X POST "$baseurl/admin/jira-jql-output-save" -H "Authorization: Bearer $token" -H "Content-Type: application/json" -d '{"type":1,"jira_base_url":"test","jira_email":"test","jira_token":"test","jql":"test","column":null}'</pre>

    <form id="exportForm">
      <input id="type" name="type" placeholder="type" required />
      <input id="jira_base_url" name="jira_base_url" placeholder="jira_base_url" required />
      <input id="jira_email" name="jira_email" placeholder="jira_email" required />
      <input id="jira_token" name="jira_token" placeholder="jira_token" required />
      <input id="jql" name="jql" placeholder="jql" required />
      <input id="column" name="column" placeholder="column (optional)" />

      <div class="row">
        <button id="clearBtn" type="button" class="btn btn-secondary">Clear</button>
        <button id="submitBtn" type="submit" class="btn btn-primary">Save Output</button>
      </div>
    </form>

    <div class="small" id="status"></div>
  </div>

</div>

<script>
(function(){

  const form = document.getElementById('exportForm');
  const status = document.getElementById('status');
  const submitBtn = document.getElementById('submitBtn');
  const clearBtn = document.getElementById('clearBtn');
  const headerToken = document.getElementById('token');

  clearBtn.addEventListener('click', ()=>{
    form.reset();
    status.textContent='';
  });

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    status.textContent = 'Working...';
    submitBtn.disabled = true;

    const typeVal = parseInt(form.type.value.trim(),10);
    if(isNaN(typeVal)){
      status.textContent = "type must be integer";
      submitBtn.disabled = false;
      return;
    }

    const data = {
      jira_base_url: form.jira_base_url.value.trim(),
      jira_email: form.jira_email.value.trim(),
      jira_token: form.jira_token.value.trim(),
      jql: form.jql.value.trim(),
      column: form.column.value.trim() || null,
      type: typeVal
    };

    try{
      const baseurl = window.location.origin;
      const resp = await fetch(baseurl + '/admin/jira-jql-output-save', {
        method:'POST',
        headers:{
          'Authorization':'Bearer ' + headerToken.value.trim(),
          'Content-Type':'application/json'
        },
        body:JSON.stringify(data)
      });

      const text = await resp.text();
      status.textContent = text;
    }catch(err){
      status.textContent = 'Error: ' + (err.message || err);
    }finally{
      submitBtn.disabled = false;
    }
  });

})();
</script>
</body>
</html>
